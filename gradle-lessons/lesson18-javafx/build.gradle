// Lesson 18: JavaFX Desktop Applications - Groovy DSL

plugins {
    id 'java'
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.0.14'
}

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

repositories {
    mavenCentral()
}

javafx {
    version = "21.0.2"
    modules = [ 'javafx.controls', 'javafx.fxml' ]
}

dependencies {
    // Testing
    testImplementation 'junit:junit:4.13.2'
    testImplementation 'org.testfx:testfx-core:4.0.18'
    testImplementation 'org.testfx:testfx-junit:4.0.18'
}

application {
    mainClass = 'com.example.javafx.HelloWorldApp'
}

// Custom run task for direct execution (bypasses plugin)
tasks.register('runDirect', JavaExec) {
    group = 'application'
    description = 'Runs the JavaFX application directly without plugin configuration'
    classpath = sourceSets.main.runtimeClasspath
    mainClass = application.mainClass.get()
    
    // Ensure output is visible
    standardOutput = System.out
    errorOutput = System.err
    
    // Get module path from runtime classpath
    def modulePath = configurations.runtimeClasspath.asPath
    
    // Configure JVM args for JavaFX
    if (System.getProperty('os.name').toLowerCase().contains('mac')) {
        jvmArgs = [
            '-XstartOnFirstThread',
            '--module-path', modulePath,
            '--add-modules', 'javafx.controls,javafx.fxml'
        ]
    } else {
        jvmArgs = [
            '--module-path', modulePath,
            '--add-modules', 'javafx.controls,javafx.fxml'
        ]
    }
}

// Configure default run task (uses plugin)
tasks.named('run', JavaExec) {
    // Ensure output is visible
    standardOutput = System.out
    errorOutput = System.err
}
